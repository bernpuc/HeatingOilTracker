<UserControl x:Class="HeatingOilTracker.Views.ReferenceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:prism="http://prismlibrary.com/"
             prism:ViewModelLocator.AutoWireViewModel="True"
             Background="White">
    <UserControl.Resources>
        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#1e293b"/>
            <Setter Property="Margin" Value="0,25,0,10"/>
        </Style>
        <Style x:Key="SubsectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#334155"/>
            <Setter Property="Margin" Value="0,15,0,5"/>
        </Style>
        <Style x:Key="BodyText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#475569"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="LineHeight" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>
        <Style x:Key="Formula" TargetType="Border">
            <Setter Property="Background" Value="#f1f5f9"/>
            <Setter Property="BorderBrush" Value="#e2e8f0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="0,5,0,10"/>
        </Style>
        <Style x:Key="FormulaText" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Consolas"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#1e293b"/>
        </Style>
        <Style x:Key="LinkText" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#2563eb"/>
            <Setter Property="Margin" Value="0,3,0,3"/>
        </Style>
    </UserControl.Resources>

    <DockPanel Margin="20">
        <!-- Header -->
        <TextBlock DockPanel.Dock="Top"
                   Text="Reference Guide"
                   FontSize="24" FontWeight="Bold"
                   Foreground="#1e293b"
                   Margin="0,0,0,5"/>
        <TextBlock DockPanel.Dock="Top"
                   Text="How calculations work in Heating Oil Tracker"
                   FontSize="14"
                   Foreground="#64748b"
                   Margin="0,0,0,10"/>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel MaxWidth="700" Margin="0,0,20,20">

                <!-- Tank Estimation -->
                <TextBlock Text="Tank Level Estimation" Style="{StaticResource SectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    The app estimates your current tank level by tracking how much oil has been used since your last delivery.
                    The preferred method uses K-Factor with weather data for accuracy; burn rate is used as a fallback.
                </TextBlock>

                <TextBlock Text="Primary Method: K-Factor (Weather-Adjusted)" Style="{StaticResource SubsectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    When weather data is available, consumption is calculated using your K-Factor and accumulated Heating Degree Days (HDD).
                    This automatically adjusts for temperature changes — a cold snap will show higher usage, a mild spell will show less.
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <TextBlock Style="{StaticResource FormulaText}">
                        Gallons Used = HDD since last fill / K-Factor
                    </TextBlock>
                </Border>
                <TextBlock Style="{StaticResource BodyText}">
                    This is more accurate than burn rate because it accounts for actual weather conditions rather than assuming
                    constant daily consumption.
                </TextBlock>

                <TextBlock Text="Fallback Method: Average Burn Rate" Style="{StaticResource SubsectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    When weather data isn't available, a simple daily average is used based on historical consumption.
                    This is less accurate during temperature swings but works when no weather data has been fetched.
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <TextBlock Style="{StaticResource FormulaText}">
                        Gallons Used = Days since last fill × Avg burn rate (gal/day)
                    </TextBlock>
                </Border>

                <!-- HDD -->
                <TextBlock Text="Heating Degree Days (HDD)" Style="{StaticResource SectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    HDD measures how cold a day was relative to a baseline temperature (65°F in the US).
                    Colder days have higher HDD values, indicating more heating is needed.
                    This metric normalizes fuel consumption across different weather conditions.
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <StackPanel>
                        <TextBlock Style="{StaticResource FormulaText}">Average Temp = (High + Low) / 2</TextBlock>
                        <TextBlock Style="{StaticResource FormulaText}">HDD = max(0, 65 - Average Temp)</TextBlock>
                    </StackPanel>
                </Border>
                <TextBlock Style="{StaticResource BodyText}">
                    Example: If the high is 40°F and the low is 20°F, the average is 30°F, giving an HDD of 35.
                    A mild day with an average of 60°F would have an HDD of only 5.
                </TextBlock>

                <!-- K-Factor -->
                <TextBlock Text="K-Factor" Style="{StaticResource SectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    The K-Factor is the industry standard measure of heating efficiency — how many Heating Degree Days
                    it takes to burn one gallon of oil. A higher K-Factor means better efficiency (more degree days per gallon).
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <TextBlock Style="{StaticResource FormulaText}">
                        K-Factor = Total HDD / Gallons Used
                    </TextBlock>
                </Border>
                <TextBlock Style="{StaticResource BodyText}">
                    Typical residential K-Factors range from 4 to 8 HDD/gallon depending on home size,
                    insulation quality, and heating system efficiency. Smaller, well-insulated homes tend toward 6-8,
                    while larger or older homes may see 3-5.
                </TextBlock>

                <!-- Burn Rate -->
                <TextBlock Text="Burn Rate" Style="{StaticResource SectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    The burn rate is the average gallons consumed per day, calculated from your delivery history.
                    This provides a simple estimate when weather data isn't available.
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <TextBlock Style="{StaticResource FormulaText}">
                        Burn Rate = Total Gallons / Total Days (between deliveries)
                    </TextBlock>
                </Border>

                <!-- Seasonal Breakdown -->
                <TextBlock Text="Seasonal Breakdown" Style="{StaticResource SectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    The app divides the year into two seasons for analysis:
                </TextBlock>
                <TextBlock Style="{StaticResource BodyText}" Margin="15,5,0,5">
                    <Run FontWeight="SemiBold">Heating Season:</Run> October through March — when most heating occurs
                </TextBlock>
                <TextBlock Style="{StaticResource BodyText}" Margin="15,0,0,8">
                    <Run FontWeight="SemiBold">Off-Season:</Run> April through September — minimal heating, typically just hot water
                </TextBlock>
                <TextBlock Style="{StaticResource BodyText}">
                    This breakdown helps identify consumption patterns and compare heating efficiency across years.
                </TextBlock>

                <!-- Carbon Footprint -->
                <TextBlock Text="Carbon Footprint" Style="{StaticResource SectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    Burning heating oil releases carbon dioxide (CO₂), a greenhouse gas. The app calculates
                    your carbon footprint using the U.S. Energy Information Administration (EIA) emission factor.
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <StackPanel>
                        <TextBlock Style="{StaticResource FormulaText}">CO₂ (lbs) = Gallons × 22.38 lbs/gallon</TextBlock>
                        <TextBlock Style="{StaticResource FormulaText}" Margin="0,5,0,0">CO₂ (metric tons) = CO₂ (lbs) × 0.000453592</TextBlock>
                    </StackPanel>
                </Border>

                <TextBlock Text="CO₂ per HDD" Style="{StaticResource SubsectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    This metric normalizes emissions by weather, allowing fair comparison across years with different temperatures.
                    A colder year will have more HDD, so comparing raw emissions would be misleading.
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <TextBlock Style="{StaticResource FormulaText}">
                        CO₂/HDD = Total CO₂ (lbs) / Total HDD
                    </TextBlock>
                </Border>

                <!-- Carbon Offsets -->
                <TextBlock Text="Carbon Offset Estimates" Style="{StaticResource SectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    Carbon offsets fund projects that reduce or remove CO₂ elsewhere — such as reforestation,
                    renewable energy, or methane capture. Prices vary widely based on project type and verification standard.
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <TextBlock Style="{StaticResource FormulaText}">
                        Offset Cost = CO₂ (metric tons) × Price per ton ($15–$50)
                    </TextBlock>
                </Border>
                <TextBlock Style="{StaticResource BodyText}">
                    The app shows a range: $15/ton represents basic offsets (e.g., forestry credits),
                    while $50/ton represents premium verified offsets (e.g., direct air capture).
                </TextBlock>
                <TextBlock Style="{StaticResource BodyText}" FontStyle="Italic" Foreground="#64748b">
                    Note: Offsets are sold based on lifetime CO₂ absorption, not annual.
                    To offset ongoing annual emissions, you would need to purchase offsets each year.
                </TextBlock>

                <!-- Cost Metrics -->
                <TextBlock Text="Cost Metrics" Style="{StaticResource SectionTitle}"/>

                <TextBlock Text="Cost per HDD" Style="{StaticResource SubsectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    Measures heating cost normalized by weather. Useful for comparing years with different temperatures.
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <TextBlock Style="{StaticResource FormulaText}">
                        $/HDD = Total Cost / Total HDD
                    </TextBlock>
                </Border>

                <TextBlock Text="Average Price per Gallon" Style="{StaticResource SubsectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    The weighted average price you paid for oil during a period.
                </TextBlock>
                <Border Style="{StaticResource Formula}">
                    <TextBlock Style="{StaticResource FormulaText}">
                        Avg $/gal = Total Cost / Total Gallons
                    </TextBlock>
                </Border>

                <!-- Weather Data -->
                <TextBlock Text="Weather Data" Style="{StaticResource SectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    Temperature data is fetched from the Open-Meteo API, a free weather service.
                    The app uses your configured ZIP code to determine location and retrieves daily high/low temperatures.
                </TextBlock>
                <TextBlock Style="{StaticResource BodyText}">
                    When a location is configured, the app automatically fetches the latest weather data on startup.
                    This ensures tank estimates using K-Factor stay accurate without manual intervention.
                    You can also manually fetch weather data from Settings if needed.
                </TextBlock>

                <!-- Further Reading -->
                <TextBlock Text="Further Reading" Style="{StaticResource SectionTitle}"/>
                <TextBlock Style="{StaticResource BodyText}">
                    Learn more about the concepts used in this app:
                </TextBlock>

                <StackPanel Margin="0,5,0,0">
                    <TextBlock Style="{StaticResource LinkText}">
                        <Run FontWeight="SemiBold">Heating Degree Days: </Run>
                        <Hyperlink NavigateUri="https://www.eia.gov/energyexplained/units-and-calculators/degree-days.php"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            eia.gov/energyexplained/units-and-calculators/degree-days.php
                        </Hyperlink>
                    </TextBlock>
                    <TextBlock Style="{StaticResource LinkText}">
                        <Run FontWeight="SemiBold">CO₂ Emission Factors: </Run>
                        <Hyperlink NavigateUri="https://www.eia.gov/environment/emissions/co2_vol_mass.php"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            eia.gov/environment/emissions/co2_vol_mass.php
                        </Hyperlink>
                    </TextBlock>
                    <TextBlock Style="{StaticResource LinkText}">
                        <Run FontWeight="SemiBold">Carbon Offsets Guide: </Run>
                        <Hyperlink NavigateUri="https://offsetguide.org/what-are-carbon-credits/"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            offsetguide.org/what-are-carbon-credits
                        </Hyperlink>
                    </TextBlock>
                    <TextBlock Style="{StaticResource LinkText}">
                        <Run FontWeight="SemiBold">Home Heating Efficiency: </Run>
                        <Hyperlink NavigateUri="https://www.energystar.gov/saveathome/heating-cooling"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            energystar.gov/saveathome/heating-cooling
                        </Hyperlink>
                    </TextBlock>
                    <TextBlock Style="{StaticResource LinkText}">
                        <Run FontWeight="SemiBold">Weather Data Source: </Run>
                        <Hyperlink NavigateUri="https://open-meteo.com"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            open-meteo.com
                        </Hyperlink>
                    </TextBlock>
                </StackPanel>

                <!-- Version note -->
                <Border Background="#f8fafc"
                        BorderBrush="#e2e8f0"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="15"
                        Margin="0,30,0,0">
                    <TextBlock Style="{StaticResource BodyText}" Margin="0" Foreground="#64748b">
                        <Run FontWeight="SemiBold">Heating Oil Tracker v1.0</Run>
                        <LineBreak/>
                        Calculations use standard industry formulas and U.S. EIA emission factors.
                        Actual consumption may vary based on equipment efficiency, home characteristics, and usage patterns.
                    </TextBlock>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</UserControl>
