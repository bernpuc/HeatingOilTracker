<UserControl x:Class="HeatingOilTracker.Views.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:prism="http://prismlibrary.com/"
             prism:ViewModelLocator.AutoWireViewModel="True"
             Background="White">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="30" MaxWidth="500" HorizontalAlignment="Left">
            <TextBlock Text="Settings"
                       FontSize="24" FontWeight="Bold"
                       Foreground="#1e293b"
                       Margin="0,0,0,25"/>

            <!-- Tank Capacity -->
            <StackPanel Margin="0,0,0,20">
                <TextBlock Text="Tank Capacity (Gallons)" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox Text="{Binding TankCapacity, UpdateSourceTrigger=PropertyChanged}"
                         Width="200" HorizontalAlignment="Left"/>
            </StackPanel>

            <!-- Location Section -->
            <Border BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,1,0,0"
                    Padding="0,20,0,0"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Location (for Degree Day Tracking)"
                               FontSize="16" FontWeight="SemiBold"
                               Foreground="#334155"
                               Margin="0,0,0,15"/>

                    <TextBlock Text="Current Location" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBlock Text="{Binding LocationDisplay}"
                               Foreground="#64748b"
                               Margin="0,0,0,15"/>

                    <TextBlock Text="Search for City/Town" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBox Text="{Binding LocationSearch, UpdateSourceTrigger=PropertyChanged}"
                                 Width="200"
                                 VerticalContentAlignment="Center"/>
                        <Button Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding SearchLocationCommand}"
                                Margin="10,0,0,0"
                                Padding="15,8">
                            <TextBlock>
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Search"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsSearchingLocation}" Value="True">
                                                <Setter Property="Text" Value="Searching..."/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Button>
                    </StackPanel>

                    <!-- Search Results -->
                    <ListBox ItemsSource="{Binding LocationSearchResults}"
                             SelectedItem="{Binding SelectedSearchResult}"
                             DisplayMemberPath="DisplayName"
                             MaxHeight="150"
                             Margin="0,0,0,10"
                             Visibility="{Binding HasSearchResults, Converter={StaticResource BoolToVisibility}}"/>

                    <TextBlock Text="Enter a city name and click Search. Select from results to set your location."
                               Foreground="#94a3b8"
                               FontSize="11"
                               TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- Currency Section -->
            <Border BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,1,0,0"
                    Padding="0,20,0,0"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Currency"
                               FontSize="16" FontWeight="SemiBold"
                               Foreground="#334155"
                               Margin="0,0,0,15"/>

                    <TextBlock Text="Display Currency" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <ComboBox ItemsSource="{Binding Currencies}"
                              SelectedItem="{Binding SelectedCulture}"
                              DisplayMemberPath="DisplayName"
                              Width="200"
                              HorizontalAlignment="Left"/>
                </StackPanel>
            </Border>

            <!-- Weather Data Section -->
            <Border BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,1,0,0"
                    Padding="0,20,0,0"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Weather Data"
                               FontSize="16" FontWeight="SemiBold"
                               Foreground="#334155"
                               Margin="0,0,0,15"/>

                    <TextBlock Text="{Binding WeatherStatus}"
                               Foreground="#64748b"
                               Margin="0,0,0,15"/>

                    <Button Command="{Binding FetchWeatherCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"
                            HorizontalAlignment="Left"
                            Padding="15,8">
                        <Button.Content>
                            <TextBlock>
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Fetch Weather Data"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsFetchingWeather}" Value="True">
                                                <Setter Property="Text" Value="Fetching..."/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Button.Content>
                    </Button>

                    <TextBlock Text="Fetches historical temperature data from Open-Meteo API to calculate heating degree days."
                               Foreground="#94a3b8"
                               FontSize="11"
                               TextWrapping="Wrap"
                               Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <!-- Delivery Reminders Section -->
            <Border BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,1,0,0"
                    Padding="0,20,0,0"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Delivery Reminders"
                               FontSize="16" FontWeight="SemiBold"
                               Foreground="#334155"
                               Margin="0,0,0,15"/>

                    <CheckBox IsChecked="{Binding ReminderEnabled}"
                              Content="Enable low-tank reminders"
                              Margin="0,0,0,15"/>

                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Alert when tank falls below (gallons):"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,5"/>
                        <TextBox Text="{Binding ThresholdGallons, UpdateSourceTrigger=PropertyChanged}"
                                 Width="120"
                                 HorizontalAlignment="Left"/>
                    </StackPanel>

                    <StackPanel Margin="0,0,0,10">
                        <TextBlock Text="Or when days remaining falls below (optional):"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,5"/>
                        <TextBox Text="{Binding ThresholdDays, UpdateSourceTrigger=PropertyChanged}"
                                 Width="120"
                                 HorizontalAlignment="Left"/>
                    </StackPanel>

                    <TextBlock Text="Alerts appear on the Dashboard when your estimated tank level drops below the threshold."
                               Foreground="#94a3b8"
                               FontSize="11"
                               TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- Cloud Backup Section -->
            <Border BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,1,0,0"
                    Padding="0,20,0,0"
                    Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Cloud Backup"
                               FontSize="16" FontWeight="SemiBold"
                               Foreground="#334155"
                               Margin="0,0,0,15"/>

                    <TextBlock Text="{Binding BackupStatus}"
                               Foreground="#64748b"
                               Margin="0,0,0,15"/>

                    <TextBlock Text="Backup Folder" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox Text="{Binding BackupFolderPath, UpdateSourceTrigger=PropertyChanged}"
                             IsReadOnly="True"
                             Background="#f8fafc"
                             Margin="0,0,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <Button Content="Browse..."
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding BrowseBackupFolderCommand}"
                                Padding="15,8"/>
                        <Button Content="Clear"
                                Style="{StaticResource SecondaryButtonStyle}"
                                Command="{Binding ClearBackupFolderCommand}"
                                Margin="10,0,0,0"
                                Padding="15,8"/>
                    </StackPanel>

                    <TextBlock Text="Select a cloud-synced folder (OneDrive, Dropbox, Google Drive) to automatically backup your data on every save."
                               Foreground="#94a3b8"
                               FontSize="11"
                               TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- Data File Location -->
            <StackPanel Margin="0,0,0,25">
                <TextBlock Text="Data File Location" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBox Text="{Binding DataFilePath, Mode=OneWay}"
                         IsReadOnly="True"
                         Background="#f8fafc"
                         Foreground="#64748b"/>
            </StackPanel>

            <!-- Save Button -->
            <Button Content="Save Settings"
                    Style="{StaticResource PrimaryButtonStyle}"
                    Command="{Binding SaveCommand}"
                    HorizontalAlignment="Left"/>
        </StackPanel>
    </ScrollViewer>
</UserControl>
